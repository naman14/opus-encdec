"use strict";var OggOpusEncoder,OpusEncoderLib;if("function"==typeof require?(OpusEncoderLib=require("https://cdn.jsdelivr.net/gh/naman14/opus-encdec@master/dist/libopus-encoder.js"),OggOpusEncoder=require("https://cdn.jsdelivr.net/gh/naman14/opus-encdec@master/dist/oggOpusEncoder.min.js").OggOpusEncoder):"function"==typeof importScripts&&(importScripts("https://cdn.jsdelivr.net/gh/naman14/opus-encdec@master/dist/libopus-encoder.js"),importScripts("https://cdn.jsdelivr.net/gh/naman14/opus-encdec@master/dist/oggOpusEncoder.min.js")),"function"==typeof registerProcessor){class e extends AudioWorkletProcessor{constructor(){super(),this.continueProcess=!0,this.port.onmessage=(({data:e})=>{if(this.encoder)switch(e.command){case"getHeaderPages":this.postPage(this.encoder.generateIdPage()),this.postPage(this.encoder.generateCommentPage());break;case"done":this.encoder.encodeFinalFrame().forEach(e=>this.postPage(e)),this.encoder.destroy(),delete this.encoder,this.port.postMessage({message:"done"});break;case"flush":this.postPage(this.encoder.flush()),this.port.postMessage({message:"flushed"})}switch(e.command){case"close":this.continueProcess=!1;break;case"init":this.encoder=new OggOpusEncoder(e,OpusEncoderLib),this.port.postMessage({message:"ready"})}})}process(e){return this.encoder&&e[0]&&e[0].length&&e[0][0]&&e[0][0].length&&this.encoder.encode(e[0]).forEach(e=>this.postPage(e)),this.continueProcess}postPage(e){e&&this.port.postMessage(e,[e.page.buffer])}}registerProcessor("encoder-worklet",e)}else{var encoder,postPageGlobal=e=>{e&&postMessage(e,[e.page.buffer])};onmessage=(({data:e})=>{if(encoder)switch(e.command){case"encode":encoder.encode(e.buffers).forEach(e=>postPageGlobal(e));break;case"getHeaderPages":postPageGlobal(encoder.generateIdPage()),postPageGlobal(encoder.generateCommentPage());break;case"done":encoder.encodeFinalFrame().forEach(e=>postPageGlobal(e)),encoder.destroy(),encoder=null,postMessage({message:"done"});break;case"flush":postPageGlobal(encoder.flush()),postMessage({message:"flushed"})}switch(e.command){case"close":close();break;case"init":encoder=new OggOpusEncoder(e,OpusEncoderLib),postMessage({message:"ready"})}})}var module=module||{};module.exports={OpusEncoderLib:OpusEncoderLib,OggOpusEncoder:OggOpusEncoder};
